{"title":"Análisis Espaciales","markdown":{"headingText":"Análisis Espaciales","containsRefs":false,"markdown":"\n```{r geo_librerias}\n#| include: false\n\nlibrary(dplyr)\nlibrary(readr)\nlibrary(stringr)\nlibrary(tidygeocoder)\nlibrary(sf)\nlibrary(mapview)\nlibrary(here)\n           \n```\n\n```{r geo_insumo}\n#| include: false\n\n# Levanto el dataset de la encuesta\n\ndf_encuesta <- read_rds(here::here(\"Outputs\", \"df_encuesta.rds\"))\n```\n\nTodos solemos tener intuiciones acerca de como el espacio influye en las decisiones de las personas. Por otro lado, la cartografía, que es la disciplina que se encarga de la confección de mapas, es una actividad milenaria. Sin embargo, desde hace relativamente pocas décadas se ha comenzado a difundir el uso de técnicas que, no sólo ubican a diferentes objetos en un mapa, sino que tambien, al mismo tiempo, permiten la realización de diferentes análisis específicamente espaciales.\n\nLos mapas, en general, son una representación gráfica basada en una proyección, que \"proyecta\" sobre un plano de 2 dimensiones (2D) una realidad tridimensional (3D). Esta representación permite hacer visible relaciones de distancia entre elementos en algún espacio. En particular, los mapas geográficos (o cartográficos) suponen unas propiedades métricas que dependen de la proyección utilizada, y posibilitan la toma de medidas de distancias, ángulos o superficies sobre él y su posterior (re)proyección a la realidad.\n\nEn la antigüedad, cuando sólo se sabía la ubicación específica de pocos elementos (no había GPS), se confiaba en la representación gráfica realizada sobre un plano (mapa) construido sobre esas (pocas) ubicaciones conocidas y se calculaba la posición de los elementos todavía no posicionados, sea tanto una nueva ciudad conocida o la propia ubicación de un viajante.\n\n## Insumo de la encuesta\n\nLos análisis que se muestran a continuación se basan en las siguientes preguntas de la encuesta:\n\n![pregunta_ubicacion_vivienda](Inputs/Images/pregunta_geo.png){width=\"600\"}\n\n```{r geo_cleaning}\n#| include: false\n\ndf_mapa <- df_encuesta |>\nselect(dni,\n       viv_calle,\n       viv_altura,\n       viv_partido) |>\nmutate(viv_provincia = \"Buenos Aires\",\n       viv_pais = \"Argentina\",\n       viv_calle_ok = if_else(str_starts(viv_calle, \"[0-9]\"),\n                                        str_glue(\"Calle {viv_calle}\"),\n                                        viv_calle),\n       viv_calle_ok = str_replace(viv_calle_ok, \"entre.*$\", \"\"), # Saco los \"entre\"\n       viv_calle_ok = str_replace(viv_calle_ok, \"[.][0-9]+$\", \"\"), # Saco los decimales\n       street = as.character(str_glue(\"{viv_altura} {viv_calle_ok}\")))\n```\n\n```{r geolocalizacion}\n#| include: false\n\ngeo <- geo(street = df_mapa$street,\n        county = df_mapa$viv_partido,\n        state = df_mapa$viv_provincia,\n        country = df_mapa$viv_pais,\n        method = 'osm',\n        lat = latitude , \n        long = longitude,\n        full_results = FALSE,\n        progress_bar = TRUE)\n\nlat_long <- df_mapa |>\n            bind_cols(geo) |>\n            write_rds(here(\"Outputs\",\"lat_long.rds\"))\n\nlat_long_sf <- lat_long |>\n                  filter(!is.na(latitude)) |>\n                  st_as_sf(\n         coords = c(\"longitude\", \"latitude\"),\n         crs = 4326,\n         dim = \"XY\") |>\n        left_join(df_encuesta, by = \"dni\") |>\n        filter(cuanti_docente == \"Diego Quartulli\") |>\n        write_rds(here(\"Outputs\",\"lat_long_sf.rds\"))\n```\n```{r geo_metricas, include=FALSE}\nunaj <- data.frame(longitude = -58.267885007422926, \n                   latitude = -34.7752210576336) |>\n         st_as_sf(coords = c(\"longitude\", \"latitude\"),\n         crs = 4326,\n         dim = \"XY\")\n\n# Extraigo la geometría\n\nlat_long_g <- st_geometry(lat_long_sf)\n\nconvex_hull <- lat_long_sf |>\n              summarise(estudiantes = st_combine(geometry))|>\n              mutate(\n              convex_hull = st_convex_hull(estudiantes)) |>\n              st_set_geometry(\"convex_hull\") |>\n             select(convex_hull)\n\ncentroide <- lat_long_sf |>\n             summarise(estudiantes = st_combine(geometry)) |>\n             mutate(\n             centroide = st_centroid(estudiantes)) |>\n             st_set_geometry(\"centroide\") |>\n             select(centroide)\n               \n```\n\n```{r distancias, include=FALSE}\nlat_long_sf <- lat_long_sf |>\nmutate(distancia = st_distance(geometry, unaj, by_element = TRUE))\n```\n\n```{r geo_mapa}\n#| echo: false\n#| output: true\n\nlibrary(leaflet)\nlibrary(leafpop)\n\nmapview(convex_hull,\n        layer.name = \"Polígono Convexo\") +\nmapview(lat_long_sf,\n        layer.name = \"Estudiantes\",\n        popup = popupTable(lat_long_sf,\n                            zcol = c(\"viv_calle.x\",\n                                     \"viv_altura.x\",\n                                     \"distancia\"))) +\nmapview(centroide,\n        cex = 8,\n        color = \"black\",\n        col.regions = \"red\") + \nmapview(unaj,\n        cex = 8,\n        col.regions = \"black\") \n# Ojo con mapview en bookdown. Hay que tener en cuenta el modo de compilación de todos los RMD\n          \n```\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","embed-resources":true,"output-file":"geo.html"},"language":{},"metadata":{"lang":"es","fig-responsive":true,"quarto-version":"1.2.269","bibliography":["bibliography.bib"],"editor":"visual","theme":"cosmo"},"extensions":{"book":{"multiFile":true}}},"pdf":{"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","output-file":"geo.pdf"},"language":{},"metadata":{"block-headings":true,"bibliography":["bibliography.bib"],"editor":"visual","lang":"es","documentclass":"scrreprt"},"extensions":{"book":{}}}}}